<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>select 태그 접근성 점검 도구</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; list-style: none; }
    body { padding: 0; font-family: sans-serif; background: #f8fafc; }
    h1 { font-size: 1.7rem; padding: 1rem; color: #1e293b; }
    .content { width: 100%; padding: 0 2rem 1.6rem; display: flex; flex-direction: column; justify-content: flex-start; gap: 1.5rem; }
    .description { color: #475569; line-height: 1.6; }
    textarea { width: 100%; min-height: 200px; padding: 1rem; border-radius: 8px; border: 1px solid #cbd5e1; font-size: 1rem; font-family: 'Courier New', monospace; }
    button { padding: 0.6em 1.4em; font-size: 1.05rem; border-radius: 7px; border: none; background: #2563eb; color: #fff; cursor: pointer; transition: background 0.2s; }
    button:hover { background: #1d4ed8; }
    button:active { transform: scale(0.98); }
    #result { max-width: 100%; background: #fff; border-radius: 10px; padding: 1.5rem; box-shadow: 0 3px 20px #0001; flex-direction: column; gap: 1rem; }
    #result section { padding-bottom: 1rem; border-bottom: 1px solid #e2e8f0; }
    #result section:last-child { padding-bottom: 0; border-bottom: none; }
    #result h2 { color: #0f172a; font-size: 1.2rem; padding-bottom: 0.8rem; display: flex; align-items: center; gap: 0.5rem; }
    .warn { color: #dc2626; font-weight: 600; }
    .ok { color: #16a34a; font-weight: 600; }
    .info { color: #0891b2; font-weight: 600; }
    .badge { display: inline-block; padding: 0.2em 0.6em; border-radius: 9999px; font-size: 0.875rem; font-weight: 600; }
    .badge-error { background: #fee2e2; color: #b91c1c; }
    .badge-success { background: #dcfce7; color: #15803d; }
    .badge-info { background: #e0f2fe; color: #0369a1; }
    .preview-wrap { background: #f1f5f9; padding: 1.2em; border-radius: 8px; overflow-x: auto; }
    .code-snippet { background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 6px; padding: 0.4em 0.6em; font-family: 'Courier New', monospace; font-size: 0.9em; color: #0f172a; }
    .metric { display: flex; justify-content: space-between; align-items: center; padding: 0.6rem; background: #f8fafc; border-radius: 6px; }
    .metric-label { font-weight: 500; color: #475569; }
    .metric-value { font-weight: 700; font-size: 1.1em; }
    summary { cursor: pointer; font-weight: 600; color: #334155; padding: 0.5rem; background: #f8fafc; border-radius: 6px; transition: background 0.2s; }
    summary:hover { background: #e2e8f0; }
    .issue-item { background: #fef9f3; border-left: 4px solid #f59e0b; padding: 0.8rem; border-radius: 0 6px 6px 0; }
    .issue-item.error { background: #fef2f2; border-left-color: #ef4444; }
    .issue-item.success { background: #f0fdf4; border-left-color: #22c55e; }
  </style>
</head>
<body>
  <h1>🔍 select 태그 접근성 점검 도구</h1>
  <main class="content">
    <div class="description">
      이 도구는 <strong>&lt;select&gt;</strong> 요소의 접근성을 점검합니다. MDN 문서 기준과 웹 접근성 모범 사례를 기반으로 검사합니다.<br/>
      아래에 HTML 코드를 붙여넣고 "접근성 점검"을 클릭하세요.
    </div>
    <textarea id="input" placeholder="여기에 &lt;select&gt; ... &lt;/select&gt; 코드를 붙여넣으세요.&#10;&#10;예시:&#10;&lt;label for=&quot;pet-select&quot;&gt;Choose a pet:&lt;/label&gt;&#10;&lt;select id=&quot;pet-select&quot; name=&quot;pets&quot;&gt;&#10;  &lt;option value=&quot;&quot;&gt;--Please choose--&lt;/option&gt;&#10;  &lt;option value=&quot;dog&quot;&gt;Dog&lt;/option&gt;&#10;&lt;/select&gt;"></textarea>
    <button id="checkBtn">접근성 점검</button>
    <div id="result" style="display:none"></div>
  </main>

  <script>
    function escapeHtml(str) {
      return str.replace(/[&<>"']/g, c =>
        ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[c])
      );
    }

    function analyzeSelect(doc) {
      const results = {
        selects: [],
        issues: [],
        successes: []
      };

      const selects = doc.querySelectorAll('select');
      
      if (!selects.length) {
        results.issues.push('유효한 &lt;select&gt; 태그가 없습니다.');
        return results;
      }

      selects.forEach((select, index) => {
        const selectInfo = {
          index: index + 1,
          hasId: false,
          hasName: false,
          hasLabel: false,
          labelText: '',
          labelType: '',
          hasAriaLabel: false,
          ariaLabelText: '',
          hasAriaLabelledby: false,
          ariaLabelledbyText: '',
          isMultiple: false,
          size: 1,
          isRequired: false,
          isDisabled: false,
          hasForm: false,
          formId: '',
          optionsCount: 0,
          optgroupsCount: 0,
          hasEmptyOption: false,
          hasHrElements: false,
          disabledOptionsCount: 0,
          optionsWithoutValue: 0
        };

        // 기본 속성 체크
        selectInfo.hasId = select.hasAttribute('id');
        selectInfo.id = select.getAttribute('id') || '';
        selectInfo.hasName = select.hasAttribute('name');
        selectInfo.name = select.getAttribute('name') || '';
        selectInfo.isMultiple = select.hasAttribute('multiple');
        selectInfo.size = parseInt(select.getAttribute('size')) || 1;
        selectInfo.isRequired = select.hasAttribute('required');
        selectInfo.isDisabled = select.hasAttribute('disabled');
        selectInfo.hasForm = select.hasAttribute('form');
        selectInfo.formId = select.getAttribute('form') || '';

        // ARIA 속성 체크
        selectInfo.hasAriaLabel = select.hasAttribute('aria-label');
        selectInfo.ariaLabelText = select.getAttribute('aria-label') || '';
        selectInfo.hasAriaLabelledby = select.hasAttribute('aria-labelledby');
        const ariaLabelledbyId = select.getAttribute('aria-labelledby');
        if (ariaLabelledbyId) {
          const labelElement = doc.getElementById(ariaLabelledbyId);
          selectInfo.ariaLabelledbyText = labelElement ? labelElement.textContent.trim() : '[요소를 찾을 수 없음]';
        }

        // Label 연결 체크
        if (selectInfo.hasId && selectInfo.id) {
          const label = doc.querySelector(`label[for="${selectInfo.id}"]`);
          if (label) {
            selectInfo.hasLabel = true;
            selectInfo.labelText = label.textContent.trim();
            selectInfo.labelType = 'for 속성 연결';
          }
        }
        
        // 암시적 label 체크 (select가 label 안에 있는 경우)
        if (!selectInfo.hasLabel) {
          const parentLabel = select.closest('label');
          if (parentLabel) {
            selectInfo.hasLabel = true;
            selectInfo.labelText = parentLabel.textContent.trim().replace(select.textContent.trim(), '').trim();
            selectInfo.labelType = '암시적 연결 (label 내부)';
          }
        }

        // Options 분석
        const options = select.querySelectorAll('option');
        selectInfo.optionsCount = options.length;
        
        options.forEach(option => {
          if (!option.hasAttribute('value') || option.getAttribute('value') === '') {
            if (option.textContent.trim() === '' || option.textContent.includes('--') || option.textContent.includes('선택')) {
              selectInfo.hasEmptyOption = true;
            } else {
              selectInfo.optionsWithoutValue++;
            }
          }
          if (option.hasAttribute('disabled')) {
            selectInfo.disabledOptionsCount++;
          }
        });

        // Optgroup 체크
        const optgroups = select.querySelectorAll('optgroup');
        selectInfo.optgroupsCount = optgroups.length;

        // HR 요소 체크 (접근성 문제)
        const hrElements = select.querySelectorAll('hr');
        selectInfo.hasHrElements = hrElements.length > 0;

        // 점수 계산 및 이슈 판단
        if (!selectInfo.hasLabel && !selectInfo.hasAriaLabel && !selectInfo.hasAriaLabelledby) {
          results.issues.push(`Select #${selectInfo.index}: 레이블이 없습니다. label, aria-label 또는 aria-labelledby 중 하나는 필수입니다.`);
        } else if (selectInfo.hasLabel) {
          results.successes.push(`Select #${selectInfo.index}: 적절한 레이블이 연결되어 있습니다 (${selectInfo.labelType}).`);
        } else if (selectInfo.hasAriaLabel) {
          results.successes.push(`Select #${selectInfo.index}: aria-label이 제공되었습니다.`);
        } else if (selectInfo.hasAriaLabelledby) {
          results.successes.push(`Select #${selectInfo.index}: aria-labelledby로 레이블이 연결되어 있습니다.`);
        }

        if (!selectInfo.hasId) {
          results.issues.push(`Select #${selectInfo.index}: id 속성이 없습니다. label과 연결하려면 id가 필요합니다.`);
        }

        if (!selectInfo.hasName) {
          results.issues.push(`Select #${selectInfo.index}: name 속성이 없습니다. 폼 제출 시 필요합니다.`);
        }

        if (selectInfo.hasHrElements) {
          results.issues.push(`Select #${selectInfo.index}: &lt;hr&gt; 요소를 포함하고 있습니다. HR 요소는 접근성 트리에 노출되지 않아 스크린 리더 사용자에게 전달되지 않습니다.`);
        }

        if (selectInfo.isRequired && !selectInfo.hasEmptyOption) {
          results.issues.push(`Select #${selectInfo.index}: required 속성이 있지만 빈 옵션이 없습니다. 사용자가 선택을 취소할 수 없을 수 있습니다.`);
        }

        if (selectInfo.optionsWithoutValue > 0) {
          results.issues.push(`Select #${selectInfo.index}: value 속성이 없는 옵션이 ${selectInfo.optionsWithoutValue}개 있습니다.`);
        }

        if (selectInfo.optionsCount === 0) {
          results.issues.push(`Select #${selectInfo.index}: 옵션이 하나도 없습니다.`);
        }

        if (selectInfo.isMultiple) {
          results.successes.push(`Select #${selectInfo.index}: multiple 속성이 있어 다중 선택이 가능합니다.`);
        }

        if (selectInfo.optgroupsCount > 0) {
          results.successes.push(`Select #${selectInfo.index}: optgroup을 사용하여 옵션을 논리적으로 그룹화했습니다.`);
        }

        results.selects.push(selectInfo);
      });

      return results;
    }

    document.getElementById('checkBtn').onclick = function() {
      const code = document.getElementById('input').value.trim();
      const resultDiv = document.getElementById('result');
      resultDiv.style.display = 'flex';
      
      if (!code) {
        resultDiv.innerHTML = '<span class="warn">※ HTML 코드를 입력해주세요.</span>';
        return;
      }

      // HTML 파싱
      const parser = new DOMParser();
      const doc = parser.parseFromString(`<body>${code}</body>`, 'text/html');
      
      // 분석 실행
      const analysis = analyzeSelect(doc);
      
      // 결과 HTML 생성
      let htmlResult = '';

      // 주요 이슈
      if (analysis.issues.length > 0) {
        htmlResult += `<section>
          <h2>❌ 접근성 이슈 <span class="badge badge-error">${analysis.issues.length}개</span></h2>`;
        analysis.issues.forEach(issue => {
          htmlResult += `<div class="issue-item error">${issue}</div>`;
        });
        htmlResult += `</section>`;
      }

      // 성공 항목
      if (analysis.successes.length > 0) {
        htmlResult += `<section>
          <h2>✅ 올바른 구현 <span class="badge badge-success">${analysis.successes.length}개</span></h2>`;
        analysis.successes.forEach(success => {
          htmlResult += `<div class="issue-item success">${escapeHtml(success)}</div>`;
        });
        htmlResult += `</section>`;
      }

      // 상세 분석
      if (analysis.selects.length > 0) {
        htmlResult += `<section>
          <h2>📊 상세 분석 정보</h2>`;
        
        analysis.selects.forEach(selectInfo => {
          htmlResult += `<details>
            <summary>▶ Select #${selectInfo.index} ${selectInfo.id ? `(id="${selectInfo.id}")` : '(id 없음)'}</summary>
            <div style="padding: 1rem 0;">
              <div class="metric">
                <span class="metric-label">ID 속성:</span>
                <span class="metric-value ${selectInfo.hasId ? 'ok' : 'warn'}">${selectInfo.hasId ? selectInfo.id : '없음'}</span>
              </div>
              <div class="metric">
                <span class="metric-label">Name 속성:</span>
                <span class="metric-value ${selectInfo.hasName ? 'ok' : 'warn'}">${selectInfo.hasName ? selectInfo.name : '없음'}</span>
              </div>
              <div class="metric">
                <span class="metric-label">Label 연결:</span>
                <span class="metric-value ${selectInfo.hasLabel ? 'ok' : 'warn'}">${selectInfo.hasLabel ? `있음 (${selectInfo.labelType})` : '없음'}</span>
              </div>
              ${selectInfo.labelText ? `
              <div class="metric">
                <span class="metric-label">Label 텍스트:</span>
                <span class="metric-value">"${escapeHtml(selectInfo.labelText)}"</span>
              </div>` : ''}
              ${selectInfo.hasAriaLabel ? `
              <div class="metric">
                <span class="metric-label">aria-label:</span>
                <span class="metric-value">"${escapeHtml(selectInfo.ariaLabelText)}"</span>
              </div>` : ''}
              ${selectInfo.hasAriaLabelledby ? `
              <div class="metric">
                <span class="metric-label">aria-labelledby:</span>
                <span class="metric-value">"${escapeHtml(selectInfo.ariaLabelledbyText)}"</span>
              </div>` : ''}
              <div class="metric">
                <span class="metric-label">옵션 개수:</span>
                <span class="metric-value">${selectInfo.optionsCount}개</span>
              </div>
              <div class="metric">
                <span class="metric-label">Optgroup 사용:</span>
                <span class="metric-value ${selectInfo.optgroupsCount > 0 ? 'info' : ''}">
                  ${selectInfo.optgroupsCount > 0 ? `${selectInfo.optgroupsCount}개` : '사용 안 함'}
                </span>
              </div>
              <div class="metric">
                <span class="metric-label">Multiple 선택:</span>
                <span class="metric-value">${selectInfo.isMultiple ? '가능' : '불가능'}</span>
              </div>
              <div class="metric">
                <span class="metric-label">Required:</span>
                <span class="metric-value">${selectInfo.isRequired ? '필수' : '선택'}</span>
              </div>
              ${selectInfo.hasHrElements ? `
              <div class="metric">
                <span class="metric-label">HR 요소:</span>
                <span class="metric-value warn">⚠️ 접근성 문제 있음</span>
              </div>` : ''}
              ${selectInfo.disabledOptionsCount > 0 ? `
              <div class="metric">
                <span class="metric-label">비활성화된 옵션:</span>
                <span class="metric-value">${selectInfo.disabledOptionsCount}개</span>
              </div>` : ''}
            </div>
          </details>`;
        });
        
        htmlResult += `</section>`;
      }

      // 미리보기
      htmlResult += `<section>
        <h2>👁️ 입력한 코드 미리보기</h2>
        <div class="preview-wrap">${code}</div>
      </section>`;

      // 접근성 점검 사항
      htmlResult += `<section>
        <h2>💡 접근성 점검 사항</h2>
        <ul>
          <li><strong>▷ 레이블은 필수:</strong> 모든 select 요소는 label, aria-label, 또는 aria-labelledby를 통해 명확한 설명을 제공해야 합니다.</li>
          <li><strong>▷ id와 name 속성:</strong> id는 label과 연결하기 위해, name은 폼 데이터 전송을 위해 필요합니다.</li>
          <li><strong>▷ HR 요소 주의:</strong> select 내부의 &lt;hr&gt; 요소는 스크린 리더에 전달되지 않으므로 시각적 구분만 제공합니다.</li>
          <li><strong>▷ optgroup 활용:</strong> 많은 옵션이 있을 경우 optgroup으로 논리적 그룹을 만들면 탐색이 쉬워집니다.</li>
          <li><strong>▷ 기본값 제공:</strong> required가 아닌 경우 "선택하세요" 같은 빈 옵션을 첫 번째로 제공하는 것이 좋습니다.</li>
          <li><strong>▷ 키보드 접근성:</strong> select 요소는 기본적으로 키보드로 접근 가능하지만, 커스텀 스타일링 시 주의가 필요합니다.</li>
        </ul>
      </section>`;

      resultDiv.innerHTML = htmlResult;
    };

    // 예제 코드 자동 입력 (디버깅용)
    document.addEventListener('DOMContentLoaded', function() {
      const textarea = document.getElementById('input');
      if (textarea.value === '') {
        textarea.placeholder = `여기에 <select> ... </select> 코드를 붙여넣으세요.`;
      }
    });
  </script>
</body>
</html>